<!DOCTYPE html>

<head>
    <title>Punched Card Reader</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" type="text/css" />
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <style type="text/css">
        .panel-heading a:after {
            font-family: 'Glyphicons Halflings';
            content: "\e260";
            float: right;
            color: white;
        }
        
        .panel-heading a.collapsed:after {
            content: "\e259";
        }
    </style>
</head>

<body>
    <div class="text-center jumbotron">
        <h1>Punched Card Reader</h1>
        <p>Read punched card generated by <a href="http://www.kloth.net/services/cardpunch.php" target="_blank">kloth.net</a></p>
    </div>

    <div class="container">
        <form>
            <div class="form-group">
                <label for="image_file">Choose your card image and card color: </label><input class="form-control" type="file" id="image_file" name="files" accept="image/*" />
            </div>

            <div class="form-group">
                <label for="card-color">Card color: </label>
                <select class="form-control" id="card-color" onchange="handleCardColor()">
                    <option value="card-yellow">Yellow</option>
                    <option value="card-red">Red</option>
                    <option value="card-green">Green</option>        
                    <option value="card-custom">Custom</option>        
                </select>
            </div>

            <div class="form-group">
                <label for="punch-color">Custom punch color (eg 0 for black, 255 for white): </label>
                <input class="form-control" type="number" min="0" max="255" value="20" id="punch-color" onchange="handlePunchColor()" disabled/>
            </div>

            <a name="thumb-blocks"></a>
            <div class="form-group">
                <label>Or select from an example image below: </label>
                <div class="row">
                    <div class="col-xs-4">
                        <div class="thumbnail">
                            <img id="yellow-card" src="images/example-yellow.png"></img>
                            <div class="caption">
                                <p class="text-center"><a href="#thumb-blocks" class="btn btn-info" id="sel-yellow-card" role="button">Select yellow card</a></p>
                            </div>
                        </div>

                    </div>
                    <div class="col-xs-4">
                        <div class="thumbnail">
                            <img id="red-card" src="images/example-red.png"></img>
                            <div class="caption">
                                <p class="text-center"><a href="#thumb-blocks" class="btn btn-info" id="sel-red-card" role="button">Select red card</a></p>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-4">
                        <div class="thumbnail">
                            <img id="green-card" src="images/example-green.png"></img>
                            <div class="caption">
                                <p class="text-center"><a href="#thumb-blocks" class="btn btn-info" id="sel-green-card" role="button">Select green card</a></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>

        <div class="panel panel-primary">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" href="#panel1">Original Image</a>
                </h4>
            </div>
            <div id="panel1" class="collapse">
                <div class="panel-body"><img id="org_image" src="" class="img-responsive"></img>
                </div>
            </div>
        </div>

        <div class="panel panel-primary">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" href="#panel2">Punch Positions</a>
                </h4>
            </div>
            <div id="panel2" class="collapse">
                <div class="panel-body"><img id="punch_image" src="" class="img-responsive"></img>
                </div>
            </div>
        </div>

        <div class="panel panel-primary">
            <div class="panel-heading">
                <h4 class="panel-title">Encoded Message</h4>
            </div>
            <div class="panel-body">
                <div id="result"></div>
            </div>
        </div>

        <div id="error-modal" class="modal fade" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title">Invalid image dimensions</h4>
                    </div>
                    <div class="modal-body">
                        <p class="text-danger">Sorry, this does not look like an image generated from kloth.net. The image must have a dimension of 588 x 264.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <hr>
            <div class="col-lg-12 text-center">
                <p class="muted">Developed by <a href="https://0xec.blogspot.com/" target="_blank">Extreme Coders</a> | <a href="https://github.com/extremecoders-re/punch-reader" target="_blank">Source on Github!</a></p>
            </div>

        </div>
    </div>

    <script type="text/javascript" src="main.js"></script>
    <script type="text/javascript">
        window.onload = function() {
            document.getElementById("image_file").addEventListener("change", handleFileSelect, false);
            document.getElementById("sel-yellow-card").addEventListener("click", handleYellowExampleCard, false);
            document.getElementById("sel-red-card").addEventListener("click", handleRedExampleCard, false);
            document.getElementById("sel-green-card").addEventListener("click", handleGreenExampleCard, false);
        };
    </script>
</body>

</html>
